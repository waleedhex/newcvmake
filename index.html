<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุดุฆ ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุงููุชูุฏู</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Tajawal:wght@300;400;500;700&family=Noto+Sans+Arabic:wght@300;400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<style>
  :root {
    --primary: #0f172a;
    --secondary: #1d4ed8;
    --text: #000000;
    --heading: #0f172a;
    --divider: #e5e7eb;
    --divider-w: 1px;
    --avatar-border: conic-gradient(#4f46e5, #22c55e, #06b6d4, #4f46e5);

    /* ุฃููุงู ุงูุฎุทูุท */
    --name-color: #ffffff;
    --heading-color: #ffffff;
    --text-color: #000000;
    --secondary-text-color: #666666;

    --base-font: 14px;
    --h1-font: 28px;
    --h2-font: 22px;
    --h3-font: 18px;
    --h4-font: 16px;
    --name-font: 28px;
    --section-gap: 18px;
    --item-gap: 8px;
    --aside-w: 280px;
    --grid-min: 180px;
    --card-min-h: 84px;
    --card-pad: 12px;

    --card-radius: 12px;
    --shadow-size: 8px;
    --card-border: 0px solid #e5e7eb;

    --font-body: "Cairo", "Tajawal", "Noto Sans Arabic", "Amiri", sans-serif;
    --font-head: "Cairo", "Tajawal", "Noto Sans Arabic", "Amiri", sans-serif;
    --font-name: "Tajawal", "Cairo", "Noto Sans Arabic", "Amiri", sans-serif;

    /* ุฃุจุนุงุฏ A4 ุซุงุจุชุฉ ุนูู ุงูุดุงุดุฉ (โ 96dpi) */
    --page-w: 793px;   /* 210mm โ 8.27in ร 96 */
    --page-h: 1122px;  /* 297mm โ 11.69in ร 96 */
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--font-body);
    background-color: #0b1020;
    color: #e5e7eb;
    min-height: 100vh;
    display: grid;
    grid-template-columns: 390px 1fr;
  }

  /* ููุญุฉ ุงูุชุญูู */
  .controls {
    background: #0f172a;
    border-inline-end: 1px solid #1f2937;
    padding: 10px;
    overflow-y: auto;
    height: 100vh;
    position: sticky;
    top: 0;
  }

  .controls-section {
    background: #0b1222;
    border: 1px solid #1f2937;
    border-radius: 12px;
    margin: 8px 0;
    overflow: hidden;
  }

  .section-header {
    padding: 12px 14px;
    font-weight: 800;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #0f172a;
  }

  .section-content {
    padding: 0 12px 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .field { display: flex; flex-direction: column; gap: 6px; margin: 10px 0; }
  .stack { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
  label.small { font-size: 13px; opacity: .9; }

  input[type="text"], input[type="number"], input[type="file"], input[type="range"], input[type="color"], textarea, select {
    width: 100%;
    background: #0b1529;
    color: #e5e7eb;
    border: 1px solid #1f2937;
    border-radius: 10px;
    padding: 8px 10px;
    outline: none;
  }
  input[type="color"] { width: 40px; height: 30px; padding: 0; border: none; cursor: pointer; }
  input[type="range"] { padding: 0; }
  textarea { min-height: 70px; }

  .btn {
    background: #22c55e; color: #052e16; border: none; padding: 8px 12px;
    border-radius: 10px; font-weight: 800; cursor: pointer; transition: all 0.3s ease;
  }
  .btn:hover { opacity: 0.9; transform: translateY(-2px); }
  .btn.ghost { background: transparent; border: 1px solid #1f2937; color: #cfe3ff; }
  .btn.dan { background: #ef4444; color: #2b0b0b; }

  .list { display: flex; flex-direction: column; gap: 8px; }
  .chip {
    display: flex; justify-content: space-between; align-items: center; gap: 8px;
    background: #0b1529; border: 1px solid #1f2937; padding: 8px 10px; border-radius: 10px; cursor: move;
  }
  .chip .drag-handle { cursor: grab; color: #9ca3af; margin-left: 5px; }
  .chip .drag-handle:active { cursor: grabbing; }

  .section-controls { display: flex; align-items: center; gap: 10px; }
  .section-controls select {
    background: #1f2937; color: #cfe3ff; border: 1px solid #374151;
    border-radius: 6px; padding: 4px 8px; font-size: 12px; min-width: 100px;
  }
  .section-controls label { font-size: 12px; color: #cfe3ff; display: flex; align-items: center; gap: 4px; }

  .toolbar {
    position: sticky; bottom: 0; background: #0f172a; padding: 8px;
    border-top: 1px solid #1f2937; z-index: 2;
  }

  /* ุชุญูู ุงูุฃููุงู */
  .color-palettes { display: flex; flex-direction: column; gap: 10px; }
  .palette-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
  .palette { cursor: pointer; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: transform 0.3s ease; }
  .palette:hover { transform: scale(1.05); }
  .palette .colors { display: flex; height: 20px; }
  .palette .name { font-size: 11px; text-align: center; padding: 3px; background: #0b1529; }

  .color-picker { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
  .color-control { display: flex; align-items: center; gap: 8px; }

  /* ุชุญูู ุงูุฃุดูุงู ูุงูุฃุญุฌุงู */
  .size-controls { display: flex; flex-direction: column; gap: 15px; }
  .slider-with-preview { display: flex; flex-direction: column; gap: 8px; }
  .slider-control { display: flex; align-items: center; gap: 10px; }
  .slider-control input[type="range"] { flex: 1; }
  .slider-control .value {
    min-width: 40px; text-align: center; font-size: 12px; background: #1f2937; padding: 4px 8px; border-radius: 6px;
  }

  /* ุงููุนุงููุฉ */
  .preview {
    padding: 16px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    overflow: auto;
  }

  .a4-container {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
  }

  /* โ ุงููุฑูุฉ ุจุฃุจุนุงุฏ A4 ุซุงุจุชุฉ ุจูุญุฏุงุช px + ููุน ุงูุถุบุท ุฏุงุฎู Flex */
  .a4 {
    width: var(--page-w);
    min-height: var(--page-h);          /* ุฃู height: var(--page-h) ุฅุฐุง ุชุจุบู ุทูู ุซุงุจุช */
    background: #fff;
    color: var(--text);
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0,0,0,.45);
    overflow: hidden;
    position: relative;
    transform-origin: top center;
    transition: transform 0.3s ease;
    flex: 0 0 auto;                     /* ูููุน ุงูุงูููุงุด ุฏุงุฎู Flex */
    max-width: none;                     /* ูุง ุชูููุฏ ุจุงูุนุฑุถ ุงููุชุงุญ */
    /* ุงุฎุชูุงุฑู: ุถูุงู ุงููุณุจุฉ ุจุฏูุฉ ุฅุถุงููุฉ */
    aspect-ratio: 210 / 297;
  }

  .cv {
    display: grid;
    grid-template-columns: var(--aside-w) var(--divider-w) 1fr;
    min-height: var(--page-h);
    height: 100%;
    font-size: var(--base-font);
    font-family: var(--font-body);
  }

  .aside {
    background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
    color: #eef2ff;
    padding: 22px;
    display: flex;
    flex-direction: column;
    gap: var(--section-gap);
    min-height: var(--page-h);
    height: 100%;
  }

  .divider { background: var(--divider); }

  .main {
    padding: 24px 28px;
    display: flex;
    flex-direction: column;
    gap: var(--section-gap);
    min-width: 0; /* ููู ูุน Grid ูููุน ุงูุถุบุงุท ุบูุฑ ูุชููุน */
  }

  .row-top { display: flex; align-items: center; gap: 12px; }

  .avatar {
    width: 96px; height: 96px; min-width: 96px; min-height: 96px;
    border-radius: 50%; background: var(--avatar-border); padding: 3px; flex: 0 0 auto;
  }
  .avatar > img {
    width: 100%; height: 100%; border-radius: 50%; object-fit: cover; display: block; background: #0b1222;
  }

  .title-box { min-width: 0; flex: 1 1 auto; }
  .name {
    font-weight: 900; line-height: 1.2; font-size: var(--name-font); color: var(--name-color);
    word-break: break-word; font-family: var(--font-name);
  }
  .role { opacity: .95; margin-top: 4px; color: var(--secondary-text-color); }

  .section { display: flex; flex-direction: column; gap: var(--item-gap); }
  .section h3 { margin: 0; color: var(--heading-color); font-size: var(--h3-font); font-family: var(--font-head); }

  .tag {
    display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px;
    border-radius: 999px; background: #eef2ff; color: #1f2937; font-weight: 800; font-size: 12px; cursor: move; margin: 2px;
  }

  .kv {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: var(--item-gap) 10px;
    font-size: calc(var(--base-font)*.95);
  }

  .summary { background: #f8fafc; border: 1px solid #e5e7eb; padding: var(--card-pad); border-radius: var(--card-radius); }

  /* ููุงุฑุงุช */
  .skill-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(var(--grid-min), 1fr));
    gap: var(--item-gap);
    align-items: start;
  }

  .skill {
    background: #ffffff; border-radius: var(--card-radius); padding: var(--card-pad);
    box-shadow: 0 4px var(--shadow-size) rgba(2,6,23,.08);
    display: flex; flex-direction: row; align-items: center; gap: 12px;
    min-height: var(--card-min-h); border: var(--card-border);
  }

  .skill .label {
    font-weight: 800; font-size: 13px; color: #000000;
    word-wrap: break-word; overflow-wrap: break-word; text-align: right; flex: 1; margin-right: 8px;
  }

  .gauge-container { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .gauge svg { width: 100%; height: 100%; }
  .g-bg { stroke: #e5e7eb; fill: none; }
  .g-ring { fill: none; stroke-linecap: round; transform: rotate(-90deg); transform-origin: 50% 50%; }
  .g-center { font-size: 12px; font-weight: bold; text-anchor: middle; dominant-baseline: middle; fill: var(--text-color); }

  .bar { width: 50px; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; flex-shrink: 0; }
  .bar span { display: block; height: 100%; border-radius: 4px; background: var(--skill-color, var(--secondary)); }
  .stars { color: var(--skill-color, gold); font-size: 14px; width: 50px; text-align: center; flex-shrink: 0; }

  /* โ ุนุฑุถ ุดุจูู ุซุงุจุช 4 ุฃุนูุฏุฉ ุฏุงุฎู ุงููุฑูุฉ */
  .grid-layout {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr)); /* 4 ุฃุนูุฏุฉ ุฏุงุฆููุง */
    gap: 12px;
    align-items: start;
    width: 100%;
  }

  .experience-item, .education-item, .extra-data-item {
    background: #f8fafc; border: var(--card-border); border-radius: var(--card-radius);
    padding: var(--card-pad); box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s ease, box-shadow 0.2s ease; width: 100%; box-sizing: border-box;
  }
  .experience-item:hover, .education-item:hover, .extra-data-item:hover {
    transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }

  /* (ุญุฐููุง ูู ููุฏูุง ูุงูุช ุชุบููุฑ ุนุฏุฏ ุงูุฃุนูุฏุฉ) */

  /* ูุงูุฐุฉ ุงูุฏูุน */
  .modal {
    position: fixed; inset: 0; background: rgba(0,0,0,0.6);
    display: flex; justify-content: center; align-items: center; z-index: 9999;
  }
  .modal.hidden { display: none; }
  .modal-content {
    background: #fff; color: #111; padding: 24px; border-radius: 12px;
    max-width: 420px; width: 92%; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.4); line-height: 1.7;
  }
  .modal-actions { display: flex; justify-content: space-around; gap: 10px; margin-top: 18px; }

  /* ุชูุงุตูู ูุงุจูุฉ ููุทู */
  details {
    border: 1px solid #1f2937; border-radius: 12px; margin: 8px 0; background: #0b1222; overflow: hidden; transition: all 0.3s ease;
  }
  details[open] { background: #0f172a; }
  summary {
    cursor: pointer; padding: 12px 14px; font-weight: 800; list-style: none;
    display: flex; justify-content: space-between; align-items: center; background: #0f172a; transition: all 0.3s ease; position: relative;
  }
  summary:hover { background: #1f2937; }
  summary::-webkit-details-marker { display: none; }
  summary::after { content: 'โผ'; font-size: 12px; transition: transform 0.3s ease; color: #9ca3af; }
  details[open] summary::after { transform: rotate(180deg); }

  /* ุงูุณุญุจ ูุงูุฅููุงุช */
  .sortable-ghost { opacity: 0.8; background: rgba(29, 78, 216, 0.2); border: 2px dashed #1d4ed8; }
  .sortable-chosen { opacity: 1; transform: scale(1.02); }
  .sortable-drag { opacity: 0.9; transform: rotate(2deg); }

  /* โ ุนุฑุถ ุงูุฌูุงู - ูุณุฎุฉ ูุธููุฉ ูุง ุชุบููุฑ ุงููุฑูุฉ ููุง ุงูุฃุนูุฏุฉ */
  @media (max-width: 768px) {
    body { grid-template-columns: 1fr; grid-template-rows: 50vh 50vh; }
    .controls { height: 50vh; position: relative; overflow-y: auto; }
    .preview {
      height: 50vh; position: relative; background: #1f2937; overflow: auto;
      padding: 0;              /* ุฅุฒุงูุฉ ุงูุญุดูุงุช ุญูู ุงููุฑูุฉ */
    }
    .a4-container { padding: 0; } /* ุฅุฒุงูุฉ ุงูุญุดูุงุช ุญูู ุงููุฑูุฉ */
    /* โ๏ธ ูุง ุชุบููุฑ ุงููุฑูุฉ (.a4) ููุง ุงูุดุจูุฉ (.cv) ููุง */
  }

  @media (max-width: 480px) {
    .preview { padding: 0; }
    .a4-container { padding: 0; }
    /* โ๏ธ ูุง ุชุบููุฑ ุงููุฑูุฉ (.a4) ููุง ุงูุดุจูุฉ (.cv) ููุง */
  }
/* === ุฅุตูุงุญุงุช ููุฌูุงู + ุงูุนุฑุจูุฉ === */

/* 1) ููุน ุงูุชูุจูุฑ ุงูุชููุงุฆู ุนูุฏ ุงูุชุฑููุฒ ุนูู ุงูุญููู (iOS/Android) */
input,
select,
textarea {
  font-size: 16px !important; /* ุงูุญุฏ ุงูุฃุฏูู ุงููู ูููุน ุงูุฒูู */
}

/* 2) ุชุซุจูุช ุญุฌู ุงููุต ูุนุฏู ุชุบููุฑู ุชููุงุฆููุง */
html {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

/* 3) ููุน ุฃู ุชุจุงุนุฏ ุจูู ุงูุญุฑูู ุงูุนุฑุจูุฉ */
[dir="rtl"], 
[lang="ar"] {
  letter-spacing: 0 !important;
  word-break: normal !important;
}
#previewSummary {
  word-break: normal !important;     /* ูููุน ุชูุทูุน ุงูุนุฑุจูุฉ */
  overflow-wrap: break-word;         /* ููู ุงูุณุทุฑ ุฅุฐุง ุถุงู ูุน ุงูุญูุงุธ ุนูู ุงุชุตุงู ุงูุญุฑูู */
  letter-spacing: 0 !important;      /* ูููุน ุฃู ุชุจุงุนุฏ ุฅุถุงูู */
  font-family: "Tajawal","Cairo","Noto Sans Arabic", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important; /* ุฎุท ุนุฑุจู ูุถููู ูุน fallback ููุฌูุงู */
direction: rtl !important;         /* ุถูุงู ุงููุชุงุจุฉ ูู ุงููููู ุฅูู ุงููุณุงุฑ */
text-align: right !important;      /* ูุญุงุฐุงุฉ ุงููุต ุฅูู ุงููููู */
overflow-wrap: break-word !important; /* ููุน ุงูุชูุทูุน ูู ุงูุชุตุฏูุฑ */
white-space: pre-line !important;     /* ูู ุทุจูุนู ูู PDF */
}

.exporting #previewSummary {
  word-break: normal !important;
  text-align: start !important; /* ูู ููุช ุชุณุชุฎุฏู justify */
}


</style>
    <script>
        // ุงูุชุฃูุฏ ูู ุชุญููู ููุชุจุฉ jsPDF
        window.jspdf = window.jspdf || {};
        if (typeof window.jspdf.jsPDF === 'undefined') {
            console.log('ุชููุฆุฉ ููุชุจุฉ jsPDF...');
            if (typeof window.jsPDF !== 'undefined') {
                window.jspdf.jsPDF = window.jsPDF;
            }
        }
    </script>
</head>
<body>
    <!-- ููุญุฉ ุงูุชุญูู -->
    <div class="controls">
        <!-- ุงููุนูููุงุช ุงูุดุฎุตูุฉ -->
        <details open>
            <summary>ุงููุนูููุงุช ุงูุดุฎุตูุฉ</summary>
            <div class="section-content">
                <div class="field">
                    <label class="small">ุงูุงุณู ุงููุงูู</label>
                    <input type="text" id="fullName" placeholder="ุฃุฏุฎู ุงุณูู ุงููุงูู" oninput="updatePreview()">
                </div>
                <div class="field">
                    <label class="small">ุงููุณูู ุงููุธููู</label>
                    <input type="text" id="jobTitle" placeholder="ูุทูุฑ ููุจุ ูุตูู ุฌุฑุงููู..." oninput="updatePreview()">
                </div>
                <div class="field">
                    <label class="small">ุงููุจุฐุฉ ุงูุดุฎุตูุฉ</label>
                    <textarea id="summary" placeholder="ุงูุชุจ ูุจุฐุฉ ูุฎุชุตุฑุฉ ุนูู..." oninput="updatePreview()"></textarea>
                </div>
                <div class="field">
                    <label class="small">ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ</label>
                    <input type="file" id="profileImage" accept="image/*" onchange="handleImageUpload(this)">
                </div>
                <div class="field">
                    <label>
                        <input type="checkbox" id="hideImage" onchange="updatePreview()"> ุฅุฎูุงุก ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ
                    </label>
                </div>
                <div class="field">
                    <label>
                        <input type="checkbox" id="hideSummary" onchange="toggleSection('summary')"> ุฅุฎูุงุก ุงููุจุฐุฉ ุงูุดุฎุตูุฉ
                    </label>
                </div>
            </div>
        </details>

        <!-- ูุนูููุงุช ุงูุงุชุตุงู -->
        <details open>
            <summary>ูุนูููุงุช ุงูุงุชุตุงู</summary>
            <div class="section-content">
                <div class="field">
                    <label class="small">ุฑูู ุงููุงุชู</label>
                    <input type="text" id="phone" placeholder="+966 50 123 4567" oninput="updatePreview()">
                </div>
                <div class="field">
                    <label class="small">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                    <input type="text" id="email" placeholder="example@email.com" oninput="updatePreview()">
                </div>
                <div class="field">
                    <label class="small">ุงูุนููุงู</label>
                    <input type="text" id="address" placeholder="ุงูุฑูุงุถุ ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ" oninput="updatePreview()">
                </div>
                <div class="field">
                    <label class="small">ุงููููุน ุงูุฅููุชุฑููู</label>
                    <input type="text" id="website" placeholder="www.example.com" oninput="updatePreview()">
                </div>
                <div class="field">
                    <label>
                        <input type="checkbox" id="hideWebsite" onchange="updatePreview()"> ุฅุฎูุงุก ุงููููุน ุงูุฅููุชุฑููู
                    </label>
                </div>
                <div class="field">
                    <label>
                        <input type="checkbox" id="hideContact" onchange="toggleSection('contact')"> ุฅุฎูุงุก ูุณู ูุนูููุงุช ุงูุงุชุตุงู
                    </label>
                </div>
            </div>
        </details>

        <!-- ุงูููุงุฑุงุช -->
        <details open>
            <summary>ุงูููุงุฑุงุช</summary>
            <div class="section-content">
                <div class="field">
                    <label class="small">ุงุณู ุงูููุงุฑุฉ</label>
                    <input type="text" id="skillName" placeholder="JavaScript, ุงูุชุตููู...">
                </div>
                <div class="field">
                    <label class="small">ูุณุชูู ุงูุฅุชูุงู (1-100)</label>
                    <input type="number" id="skillLevel" min="1" max="100" value="80">
                </div>
                <div class="field">
                    <label class="small">ููุน ุงูุนุฑุถ</label>
                    <select id="skillType">
                        <option value="circle">ุฏุงุฆุฑู</option>
                        <option value="bar">ุดุฑูุท</option>
                        <option value="stars">ูุฌูู</option>
                    </select>
                </div>
                <div class="field">
                    <label class="small">ููู ุงูุดูู</label>
                    <input type="color" id="skillColor" value="#3b82f6" onchange="updateSkillColor()">
                </div>
                <button class="btn" onclick="addSkill()">ุฅุถุงูุฉ ููุงุฑุฉ</button>
                <div class="list" id="skillsList"></div>
                <div class="field">
                    <label>
                        <input type="checkbox" id="hideSkills" onchange="toggleSection('skills')"> ุฅุฎูุงุก ูุณู ุงูููุงุฑุงุช
                    </label>
                </div>
            </div>
        </details>

        <!-- ุงูุฎุจุฑุงุช ุงูุนูููุฉ -->
        <details open>
            <summary>ุงูุฎุจุฑุงุช ุงูุนูููุฉ</summary>
            <div class="section-content">
                <div class="field">
                    <label class="small">ููุน ุงูุนุฑุถ</label>
                    <select id="experienceLayout" onchange="updateExperiencesPreview()">
                        <option value="vertical">ุนููุฏู (ุชูููุฏู)</option>
                        <option value="horizontal">ุฃููู (ุดุจูุฉ)</option>
                    </select>
                </div>
                <div class="field">
                    <label class="small">ุงููุณูู ุงููุธููู</label>
                    <input type="text" id="expTitle" placeholder="ูุทูุฑ ููุจ ุฃูู">
                </div>
                <div class="field">
                    <label class="small">ุงุณู ุงูุดุฑูุฉ</label>
                    <input type="text" id="expCompany" placeholder="ุดุฑูุฉ ุงูุชูููุฉ ุงููุชูุฏูุฉ">
                </div>
                <div class="field">
                    <label class="small">ุงููุชุฑุฉ ุงูุฒูููุฉ</label>
                    <input type="text" id="expPeriod" placeholder="2020 - 2023">
                </div>
                <div class="field">
                    <label class="small">ุงููุตู</label>
                    <textarea id="expDescription" placeholder="ูุตู ุงูููุงู ูุงูุฅูุฌุงุฒุงุช..."></textarea>
                </div>
                <button class="btn" onclick="addExperience()">ุฅุถุงูุฉ ุฎุจุฑุฉ</button>
                <div class="list" id="experiencesList"></div>
                <div class="field">
                    <label>
                        <input type="checkbox" id="hideExperiences" onchange="toggleSection('experiences')"> ุฅุฎูุงุก ูุณู ุงูุฎุจุฑุงุช ุงูุนูููุฉ
                    </label>
                </div>
            </div>
        </details>

        <!-- ุงูุชุนููู -->
        <details open>
            <summary>ุงูุชุนููู</summary>
            <div class="section-content">
                <div class="field">
                    <label class="small">ููุน ุงูุนุฑุถ</label>
                    <select id="educationLayout" onchange="updateEducationPreview()">
                        <option value="vertical">ุนููุฏู (ุชูููุฏู)</option>
                        <option value="horizontal">ุฃููู (ุดุจูุฉ)</option>
                    </select>
                </div>
                <div class="field">
                    <label class="small">ุงูุฏุฑุฌุฉ ุงูุนูููุฉ</label>
                    <input type="text" id="eduDegree" placeholder="ุจูุงููุฑููุณ ุนููู ุงูุญุงุณุจ">
                </div>
                <div class="field">
                    <label class="small">ุงุณู ุงูุฌุงูุนุฉ</label>
                    <input type="text" id="eduInstitution" placeholder="ุฌุงูุนุฉ ุงูููู ุณุนูุฏ">
                </div>
                <div class="field">
                    <label class="small">ุณูุฉ ุงูุชุฎุฑุฌ</label>
                    <input type="text" id="eduYear" placeholder="2020">
                </div>
                <button class="btn" onclick="addEducation()">ุฅุถุงูุฉ ุชุนููู</button>
                <div class="list" id="educationList"></div>
                <div class="field">
                    <label>
                        <input type="checkbox" id="hideEducation" onchange="toggleSection('education')"> ุฅุฎูุงุก ูุณู ุงูุชุนููู
                    </label>
                </div>
            </div>
        </details>

        <!-- ุงููุบุงุช -->
        <details open>
            <summary>ุงููุบุงุช</summary>
            <div class="section-content">
                <div class="field">
                    <label class="small">ุงุณู ุงููุบุฉ</label>
                    <input type="text" id="langName" placeholder="ุงูุฅูุฌููุฒูุฉ">
                </div>
                <div class="field">
                    <label class="small">ูุณุชูู ุงูุฅุชูุงู</label>
                    <select id="langLevel">
                        <option value="ูุจุชุฏุฆ">ูุจุชุฏุฆ</option>
                        <option value="ูุชูุณุท">ูุชูุณุท</option>
                        <option value="ูุชูุฏู">ูุชูุฏู</option>
                        <option value="ุทููู">ุทููู</option>
                        <option value="ูุบุฉ ุฃู">ูุบุฉ ุฃู</option>
                    </select>
                </div>
                <button class="btn" onclick="addLanguage()">ุฅุถุงูุฉ ูุบุฉ</button>
                <div class="list" id="languagesList"></div>
                <div class="field">
                    <label>
                        <input type="checkbox" id="hideLanguages" onchange="toggleSection('languages')"> ุฅุฎูุงุก ูุณู ุงููุบุงุช
                    </label>
                </div>
            </div>
        </details>

        <!-- ุงูููุงูุงุช -->
        <details open>
            <summary>ุงูููุงูุงุช ูุงูุงูุชูุงูุงุช</summary>
            <div class="section-content">
                <div class="field">
                    <label class="small">ููุน ุงูุนุฑุถ</label>
                    <select id="hobbiesDisplay" onchange="updateHobbiesPreview()">
                        <option value="tags">ุนูุงูุงุช</option>
                        <option value="list">ูุงุฆูุฉ</option>
                        <option value="cards">ุจุทุงูุงุช</option>
                    </select>
                </div>
                <div class="field">
                    <label class="small">ุงุณู ุงูููุงูุฉ</label>
                    <input type="text" id="hobbyName" placeholder="ุงููุฑุงุกุฉ">
                </div>
                <div class="field">
                    <label class="small">ุงูุฃููููุฉ</label>
                    <input type="text" id="hobbyIcon" placeholder="๐" maxlength="2">
                </div>
                <div class="field">
                    <label class="small">ุงููุตู (ุงุฎุชูุงุฑู)</label>
                    <input type="text" id="hobbyDescription" placeholder="ุฃุญุจ ูุฑุงุกุฉ ุงููุชุจ ุงูุชูููุฉ">
                </div>
                <button class="btn" onclick="addHobby()">ุฅุถุงูุฉ ููุงูุฉ</button>
                <div class="list" id="hobbiesList"></div>
                <div class="field">
                    <label>
                        <input type="checkbox" id="hideHobbies" onchange="toggleSection('hobbies')"> ุฅุฎูุงุก ูุณู ุงูููุงูุงุช ูุงูุงูุชูุงูุงุช
                    </label>
                </div>
            </div>
        </details>

        <!-- ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ -->
        <details open>
            <summary>ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ</summary>
            <div class="section-content">
                <div class="field">
                    <label class="small">ููุน ุงูุนุฑุถ</label>
                    <select id="extraDataDisplay" onchange="updateExtraDataPreview()">
                        <option value="vertical">ุนููุฏู (ุชูููุฏู)</option>
                        <option value="grid">ุฃููู (ุดุจูุฉ)</option>
                    </select>
                </div>
                <div class="field">
                    <label class="small">ุงุณู ุงููุณู</label>
                    <input type="text" id="extraSectionName" placeholder="ุงูุฌูุงุฆุฒุ ุงูุดูุงุฏุงุชุ ุงููุดุงุฑูุน...">
                </div>
                <div class="field">
                    <label class="small">ุงูุนููุงู</label>
                    <input type="text" id="extraTitle" placeholder="ุนููุงู ุงูุนูุตุฑ">
                </div>
                <div class="field">
                    <label class="small">ุงูุชูุงุตูู</label>
                    <input type="text" id="extraDetails" placeholder="ุชูุงุตูู ุฅุถุงููุฉ">
                </div>
                <div class="field">
                    <label class="small">ุงูุชุงุฑูุฎ</label>
                    <input type="text" id="extraDate" placeholder="2023">
                </div>
                <div class="field">
                    <label class="small">ุงูุฃููููุฉ</label>
                    <input type="text" id="extraIcon" placeholder="๐" maxlength="2">
                </div>
                <button class="btn" onclick="addExtraData()">ุฅุถุงูุฉ ุนูุตุฑ</button>
                <div class="list" id="extraDataList"></div>
                <div class="field">
                    <label>
                        <input type="checkbox" id="hideExtraData" onchange="toggleSection('extraData')"> ุฅุฎูุงุก ูุณู ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ
                    </label>
                </div>
            </div>
        </details>

        <!-- ุชุญูู ุงูุชุตููู -->
        <details>
            <summary>ุชุญูู ุงูุชุตููู</summary>
            <div class="section-content">
                <!-- ุงูุฎุทูุท -->
                <div class="field">
                    <label class="small">ููุน ุงูุฎุท</label>
                    <select id="fontFamily" onchange="updateFontFamily()">
                        <option value="Cairo">Cairo</option>
                        <option value="Tajawal">Tajawal</option>
                        <option value="Noto Sans Arabic">Noto Sans Arabic</option>
                        <option value="Amiri">Amiri</option>
                    </select>
                </div>

                <!-- ุงูุฃููุงู -->
                <div class="field">
                    <label class="small">ููุญุงุช ุงูุฃููุงู</label>
                    <div class="palette-grid">
                        <div class="palette" onclick="applyColorPalette('#0f172a', '#1d4ed8')">
                            <div class="colors">
                                <div style="background: #0f172a; flex: 1;"></div>
                                <div style="background: #1d4ed8; flex: 1;"></div>
                            </div>
                            <div class="name">ุฃุฒุฑู</div>
                        </div>
                        <div class="palette" onclick="applyColorPalette('#065f46', '#059669')">
                            <div class="colors">
                                <div style="background: #065f46; flex: 1;"></div>
                                <div style="background: #059669; flex: 1;"></div>
                            </div>
                            <div class="name">ุฃุฎุถุฑ</div>
                        </div>
                        <div class="palette" onclick="applyColorPalette('#7c2d12', '#dc2626')">
                            <div class="colors">
                                <div style="background: #7c2d12; flex: 1;"></div>
                                <div style="background: #dc2626; flex: 1;"></div>
                            </div>
                            <div class="name">ุฃุญูุฑ</div>
                        </div>
                        <div class="palette" onclick="applyColorPalette('#581c87', '#7c3aed')">
                            <div class="colors">
                                <div style="background: #581c87; flex: 1;"></div>
                                <div style="background: #7c3aed; flex: 1;"></div>
                            </div>
                            <div class="name">ุจููุณุฌู</div>
                        </div>
                    </div>
                </div>

                <div class="color-picker">
                    <div class="color-control">
                        <label class="small">ุงูููู ุงูุฃุณุงุณู</label>
                        <input type="color" id="primaryColor" value="#0f172a" onchange="updateColors()">
                    </div>
                    <div class="color-control">
                        <label class="small">ุงูููู ุงูุซุงููู</label>
                        <input type="color" id="secondaryColor" value="#1d4ed8" onchange="updateColors()">
                    </div>
                </div>

                <!-- ุฃููุงู ุงูุฎุทูุท -->
                <div class="color-picker">
                    <div class="color-control">
                        <label class="small">ููู ุงูุงุณู</label>
                        <input type="color" id="nameColor" value="#ffffff" onchange="updateFontColors()">
                    </div>
                    <div class="color-control">
                        <label class="small">ููู ุงูุนูุงููู</label>
                        <input type="color" id="headingColor" value="#ffffff" onchange="updateFontColors()">
                    </div>
                    <div class="color-control">
                        <label class="small">ููู ุงููุต ุงูุนุงุฏู</label>
                        <input type="color" id="textColor" value="#111111" onchange="updateFontColors()">
                    </div>
                    <div class="color-control">
                        <label class="small">ููู ุงููุต ุงูุซุงููู</label>
                        <input type="color" id="secondaryTextColor" value="#666666" onchange="updateFontColors()">
                    </div>
                </div>

                <!-- ุฃุญุฌุงู ุงูุฎุทูุท -->
                <div class="field">
                    <label class="small">ุญุฌู ุฎุท ุงูุงุณู</label>
                    <div class="slider-control">
                        <input type="range" id="nameFont" min="16" max="36" value="28" oninput="updateFontSizes()">
                        <span class="value" id="nameFontValue">28px</span>
                    </div>
                </div>

                <div class="field">
                    <label class="small">ุญุฌู ุฎุท ุงูุนูุงููู</label>
                    <div class="slider-control">
                        <input type="range" id="headingFont" min="14" max="22" value="18" oninput="updateFontSizes()">
                        <span class="value" id="headingFontValue">18px</span>
                    </div>
                </div>

                <div class="field">
                    <label class="small">ุญุฌู ุงููุต ุงูุนุงุฏู</label>
                    <div class="slider-control">
                        <input type="range" id="baseFont" min="10" max="18" value="14" oninput="updateFontSizes()">
                        <span class="value" id="baseFontValue">14px</span>
                    </div>
                </div>

                <!-- ุงูุชุจุงุนุฏ -->
                <div class="field">
                    <label class="small">ุงูุชุจุงุนุฏ ุจูู ุงูุฃูุณุงู</label>
                    <div class="slider-control">
                        <input type="range" id="sectionGap" min="10" max="40" value="18" oninput="updateSpacing()">
                        <span class="value" id="sectionGapValue">18px</span>
                    </div>
                </div>

                <div class="field">
                    <label class="small">ุงูุชุจุงุนุฏ ุจูู ุงูุนูุงุตุฑ</label>
                    <div class="slider-control">
                        <input type="range" id="itemGap" min="5" max="20" value="8" oninput="updateSpacing()">
                        <span class="value" id="itemGapValue">8px</span>
                    </div>
                </div>

                <div class="field">
                    <label class="small">ุงูุญุดู ุงูุฏุงุฎูู ููุจุทุงูุงุช</label>
                    <div class="slider-control">
                        <input type="range" id="cardPadding" min="8" max="24" value="12" oninput="updateSpacing()">
                        <span class="value" id="cardPaddingValue">12px</span>
                    </div>
                </div>

                <!-- ุงูุญุฏูุฏ -->
                <div class="field">
                    <label class="small">ุณูู ุญุฏูุฏ ุงูุจุทุงูุงุช</label>
                    <div class="slider-control">
                        <input type="range" id="borderWidth" min="0" max="5" value="0" oninput="updateBorders()">
                        <span class="value" id="borderWidthValue">0px</span>
                    </div>
                </div>

                <div class="field">
                    <label class="small">ููู ุงูุญุฏูุฏ</label>
                    <input type="color" id="borderColor" value="#e5e7eb" onchange="updateBorders()">
                </div>

                <div class="field">
                    <label class="small">ุงูุญูุงุก ุงูุฒูุงูุง</label>
                    <div class="slider-control">
                        <input type="range" id="borderRadius" min="0" max="20" value="12" oninput="updateBorders()">
                        <span class="value" id="borderRadiusValue">12px</span>
                    </div>
                </div>
            </div>
        </details>

        <!-- ุชุฑุชูุจ ุงูุฃูุณุงู -->
        <details>
            <summary>ุชุฑุชูุจ ุงูุฃูุณุงู</summary>
            <div class="section-content">
                <div class="field">
                    <label class="small">ุชุฑุชูุจ ููููุน ุงูุฃูุณุงู</label>
                    <div class="list" id="allSectionsList">
                        <div class="chip" data-section="contact">
                            <span><i class="fas fa-grip-vertical drag-handle"></i> ูุนูููุงุช ุงูุงุชุตุงู</span>
                            <div class="section-controls">
                                <select onchange="changeSectionLocation('contact', this.value)">
                                    <option value="sidebar" selected>ุงูุดุฑูุท ุงูุฌุงูุจู</option>
                                    <option value="main">ุงูุฌุฒุก ุงูุฑุฆูุณู</option>
                                </select>
                                <label><input type="checkbox" checked onchange="toggleSection('contact', this.checked)"> ุฅุธูุงุฑ</label>
                            </div>
                        </div>
                        <div class="chip" data-section="skills">
                            <span><i class="fas fa-grip-vertical drag-handle"></i> ุงูููุงุฑุงุช</span>
                            <div class="section-controls">
                                <select onchange="changeSectionLocation('skills', this.value)">
                                    <option value="sidebar" selected>ุงูุดุฑูุท ุงูุฌุงูุจู</option>
                                    <option value="main">ุงูุฌุฒุก ุงูุฑุฆูุณู</option>
                                </select>
                                <label><input type="checkbox" checked onchange="toggleSection('skills', this.checked)"> ุฅุธูุงุฑ</label>
                            </div>
                        </div>
                        <div class="chip" data-section="languages">
                            <span><i class="fas fa-grip-vertical drag-handle"></i> ุงููุบุงุช</span>
                            <div class="section-controls">
                                <select onchange="changeSectionLocation('languages', this.value)">
                                    <option value="sidebar" selected>ุงูุดุฑูุท ุงูุฌุงูุจู</option>
                                    <option value="main">ุงูุฌุฒุก ุงูุฑุฆูุณู</option>
                                </select>
                                <label><input type="checkbox" checked onchange="toggleSection('languages', this.checked)"> ุฅุธูุงุฑ</label>
                            </div>
                        </div>
                        <div class="chip" data-section="hobbies">
                            <span><i class="fas fa-grip-vertical drag-handle"></i> ุงูููุงูุงุช ูุงูุงูุชูุงูุงุช</span>
                            <div class="section-controls">
                                <select onchange="changeSectionLocation('hobbies', this.value)">
                                    <option value="sidebar" selected>ุงูุดุฑูุท ุงูุฌุงูุจู</option>
                                    <option value="main">ุงูุฌุฒุก ุงูุฑุฆูุณู</option>
                                </select>
                                <label><input type="checkbox" checked onchange="toggleSection('hobbies', this.checked)"> ุฅุธูุงุฑ</label>
                            </div>
                        </div>
                        <div class="chip" data-section="summary">
                            <span><i class="fas fa-grip-vertical drag-handle"></i> ุงููุจุฐุฉ ุงูุดุฎุตูุฉ</span>
                            <div class="section-controls">
                                <select onchange="changeSectionLocation('summary', this.value)">
                                    <option value="sidebar">ุงูุดุฑูุท ุงูุฌุงูุจู</option>
                                    <option value="main" selected>ุงูุฌุฒุก ุงูุฑุฆูุณู</option>
                                </select>
                                <label><input type="checkbox" checked onchange="toggleSection('summary', this.checked)"> ุฅุธูุงุฑ</label>
                            </div>
                        </div>
                        <div class="chip" data-section="experiences">
                            <span><i class="fas fa-grip-vertical drag-handle"></i> ุงูุฎุจุฑุงุช ุงูุนูููุฉ</span>
                            <div class="section-controls">
                                <select onchange="changeSectionLocation('experiences', this.value)">
                                    <option value="sidebar">ุงูุดุฑูุท ุงูุฌุงูุจู</option>
                                    <option value="main" selected>ุงูุฌุฒุก ุงูุฑุฆูุณู</option>
                                </select>
                                <label><input type="checkbox" checked onchange="toggleSection('experiences', this.checked)"> ุฅุธูุงุฑ</label>
                            </div>
                        </div>
                        <div class="chip" data-section="education">
                            <span><i class="fas fa-grip-vertical drag-handle"></i> ุงูุชุนููู</span>
                            <div class="section-controls">
                                <select onchange="changeSectionLocation('education', this.value)">
                                    <option value="sidebar">ุงูุดุฑูุท ุงูุฌุงูุจู</option>
                                    <option value="main" selected>ุงูุฌุฒุก ุงูุฑุฆูุณู</option>
                                </select>
                                <label><input type="checkbox" checked onchange="toggleSection('education', this.checked)"> ุฅุธูุงุฑ</label>
                            </div>
                        </div>
                        <div class="chip" data-section="extra">
                            <span><i class="fas fa-grip-vertical drag-handle"></i> ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ</span>
                            <div class="section-controls">
                                <select onchange="changeSectionLocation('extra', this.value)">
                                    <option value="sidebar">ุงูุดุฑูุท ุงูุฌุงูุจู</option>
                                    <option value="main" selected>ุงูุฌุฒุก ุงูุฑุฆูุณู</option>
                                </select>
                                <label><input type="checkbox" checked onchange="toggleSection('extra', this.checked)"> ุฅุธูุงุฑ</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="field">
                    <label class="small">ุนุฑุถ ุงูุดุฑูุท ุงูุฌุงูุจู</label>
                    <select id="sidebarWidth" onchange="updateSidebarWidth()">
                        <option value="240px">ุถูู (240px)</option>
                        <option value="280px" selected>ูุชูุณุท (280px)</option>
                        <option value="320px">ุนุฑูุถ (320px)</option>
                        <option value="360px">ุนุฑูุถ ุฌุฏุงู (360px)</option>
                    </select>
                </div>
                
                <div class="field">
                    <label>
                        <input type="checkbox" id="hideHeader" onchange="toggleHeaderSection()"> ุฅุฎูุงุก ูุณู ุงูุงุณู ูุงูุตูุฑุฉ
                    </label>
                </div>
                
                <button class="btn ghost" onclick="resetSectionsOrder()">ุฅุนุงุฏุฉ ุชุนููู ุงูุชุฑุชูุจ</button>
            </div>
        </details>

<!-- ุดุฑูุท ุงูุฃุฏูุงุช -->
<div class="toolbar">
  <button class="btn" onclick="showPaymentModal()">ุชุตุฏูุฑ PDF</button>

  <!-- ูููุงุณ ุงููุนุงููุฉ ุจุฌูุงุฑ ุฒุฑ ุงูุชุตุฏูุฑ -->
  <div class="scale-inline">
    <label for="scaleSlider" class="small">ูููุงุณ ุงููุนุงููุฉ</label>
    <div class="slider-control">
      <input type="range" id="scaleSlider" min="10" max="120" value="100" oninput="updateScale()">
      <span class="value" id="scaleValue">100%</span>
    </div>
  </div>
</div>
      </div>
    <!-- ุงููุนุงููุฉ -->
    <div class="preview">
        <div class="a4-container">
            <div class="a4">
                <div class="cv" id="cvPreview">
                    <!-- ุงูุดุฑูุท ุงูุฌุงูุจู -->
                    <div class="aside">
                        <!-- ุงูุตูุฑุฉ ูุงูุงุณู -->
                        <div class="row-top" id="headerSection">
                            <div class="avatar" id="avatarContainer">
                                <img id="avatarImg" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'%3E%3Ccircle cx='48' cy='48' r='48' fill='%23e5e7eb'/%3E%3Cpath d='M48 48c8.837 0 16-7.163 16-16s-7.163-16-16-16-16 7.163-16 16 7.163 16 16 16zm0 8c-10.664 0-32 5.336-32 16v8h64v-8c0-10.664-21.336-16-32-16z' fill='%23374151'/%3E%3C/svg%3E" alt="ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ">
                            </div>
                            <div class="title-box">
                                <div class="name" id="previewName">ุงุณูู ููุง</div>
                                <div class="role" id="previewRole">ุงููุณูู ุงููุธููู</div>
                            </div>
                        </div>

                        <!-- ูุนูููุงุช ุงูุงุชุตุงู -->
                        <div class="section" id="contactSection">
                            <h3>ูุนูููุงุช ุงูุงุชุตุงู</h3>
                            <div class="kv" id="contactInfo">
                                <span>๐</span><span id="previewPhone">+966 50 123 4567</span>
                                <span>โ๏ธ</span><span id="previewEmail">example@email.com</span>
                                <span>๐</span><span id="previewAddress">ุงูุฑูุงุถุ ุงูุณุนูุฏูุฉ</span>
                                <span id="websiteIcon">๐</span><span id="previewWebsite">www.example.com</span>
                            </div>
                        </div>

                        <!-- ุงูููุงุฑุงุช -->
                        <div class="section" id="skillsSection">
                            <h3>ุงูููุงุฑุงุช</h3>
                            <div class="skill-grid" id="skillsGrid">
                                <!-- ุงูููุงุฑุงุช ุณุชุธูุฑ ููุง -->
                            </div>
                        </div>

                        <!-- ุงููุบุงุช -->
                        <div class="section" id="languagesSection">
                            <h3>ุงููุบุงุช</h3>
                            <div class="kv" id="languagesGrid">
                                <!-- ุงููุบุงุช ุณุชุธูุฑ ููุง -->
                            </div>
                        </div>

                        <!-- ุงูููุงูุงุช -->
                        <div class="section" id="hobbiesSection">
                            <h3>ุงูููุงูุงุช ูุงูุงูุชูุงูุงุช</h3>
                            <div id="hobbiesGrid">
                                <!-- ุงูููุงูุงุช ุณุชุธูุฑ ููุง -->
                            </div>
                        </div>
                    </div>

                    <!-- ุงููุงุตู -->
                    <div class="divider"></div>

                    <!-- ุงููุณู ุงูุฑุฆูุณู -->
                    <div class="main">
                        <!-- ุงููุจุฐุฉ ุงูุดุฎุตูุฉ -->
                        <div class="section" id="summarySection">
                            <h3>ุงููุจุฐุฉ ุงูุดุฎุตูุฉ</h3>
<div class="summary" id="previewSummary" style="white-space: pre-line; color: var(--text-color);">                                ุงูุชุจ ูุจุฐุฉ ูุฎุชุตุฑุฉ ุนู ุฎุจุฑุงุชู ูููุงุฑุงุชู ูุฃูุฏุงูู ุงูููููุฉ...
                            </div>
                        </div>

                        <!-- ุงูุฎุจุฑุงุช ุงูุนูููุฉ -->
                        <div class="section" id="experiencesSection">
                            <h3>ุงูุฎุจุฑุงุช ุงูุนูููุฉ</h3>
                            <div id="experiencesGrid">
                                <!-- ุงูุฎุจุฑุงุช ุณุชุธูุฑ ููุง -->
                            </div>
                        </div>

                        <!-- ุงูุชุนููู -->
                        <div class="section" id="educationSection">
                            <h3>ุงูุชุนููู</h3>
                            <div id="educationGrid">
                                <!-- ุงูุชุนููู ุณูุธูุฑ ููุง -->
                            </div>
                        </div>

                        <!-- ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ -->
                        <div id="extraSections">
                            <!-- ุงูุฃูุณุงู ุงูุฅุถุงููุฉ ุณุชุธูุฑ ููุง -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ูุงูุฐุฉ ุงูุฏูุน -->
    <div class="modal hidden" id="paymentModal">
        <div class="modal-content">
            <h3>ุชุตุฏูุฑ ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ</h3>
            <p>ูุชููู ุฃูู ุงุณุชูุฏุช ูู ุงูุฃุฏุงุฉ ุนููุงู ุฃู ุณุนุฑ ุงููุณุฎุฉ ูฉ.ูฉูฉ ุฑูุงู</p>
            <div class="modal-actions">
                <button class="btn ghost" onclick="downloadPDF()">ุฅุบูุงู</button>
                <button class="btn" onclick="payAndDownload()">ุฏูุน</button>
            </div>
        </div>
    </div>
<script>
// ======================= ุงูุจูุงูุงุช ุงูุนุงูุฉ =======================
let cvData = {
  personal: { name: '', title: '', summary: '', image: '', hideImage: false },
  contact:  { phone: '', email: '', address: '', website: '', hideWebsite: false },
  skills: [],
  experiences: [],
  education: [],
  languages: [],
  hobbies: [],
  extraSections: {}
};

// ูุณุงุนุฏ ูููุฏ ุงููุณุจุฉ
function clampPercent(n){ return Math.max(0, Math.min(100, Number(n) || 0)); }

// ======================= ุงููุนูููุงุช ุงูุดุฎุตูุฉ =======================
function updatePreview() {
  // ุงูุงุณู/ุงููุณูู/ุงููุจุฐุฉ
  const name    = document.getElementById('fullName').value || 'ุงุณูู ููุง';
  const title   = document.getElementById('jobTitle').value || 'ุงููุณูู ุงููุธููู';
  const summary = document.getElementById('summary').value || 'ุงูุชุจ ูุจุฐุฉ ูุฎุชุตุฑุฉ ุนู ุฎุจุฑุงุชู ูููุงุฑุงุชู ูุฃูุฏุงูู ุงูููููุฉ...';

  document.getElementById('previewName').textContent = name;
  document.getElementById('previewRole').textContent = title;
  document.getElementById('previewSummary').textContent = summary;
document.getElementById('previewSummary').style.whiteSpace = 'pre-line';

  // ุงูุงุชุตุงู
  const phone   = document.getElementById('phone').value   || '+966 50 123 4567';
  const email   = document.getElementById('email').value   || 'example@email.com';
  const address = document.getElementById('address').value || 'ุงูุฑูุงุถุ ุงูุณุนูุฏูุฉ';
  const website = document.getElementById('website').value || 'www.example.com';

  document.getElementById('previewPhone').textContent   = phone;
  document.getElementById('previewEmail').textContent   = email;
  document.getElementById('previewAddress').textContent = address;
  document.getElementById('previewWebsite').textContent = website;

  // ุฅุฎูุงุก/ุฅุธูุงุฑ ุงูุตูุฑุฉ
  const hideImage = document.getElementById('hideImage').checked;
  document.getElementById('avatarContainer').style.display = hideImage ? 'none' : 'block';

  // ุฅุฎูุงุก/ุฅุธูุงุฑ ุงููููุน
  const hideWebsite = document.getElementById('hideWebsite').checked;
  document.getElementById('websiteIcon').style.display   = hideWebsite ? 'none' : 'inline';
  document.getElementById('previewWebsite').style.display= hideWebsite ? 'none' : 'inline';

  // ุญูุธ
  cvData.personal = { name, title, summary, hideImage };
  cvData.contact  = { phone, email, address, website, hideWebsite };
}

function handleImageUpload(input){
  if (input.files && input.files[0]){
    const reader = new FileReader();
    reader.onload = (e) => {
      document.getElementById('avatarImg').src = e.target.result;
      cvData.personal.image = e.target.result;
    };
    reader.readAsDataURL(input.files[0]);
  }
}

// ======================= ุงูููุงุฑุงุช =======================
function addSkill(){
  const name  = document.getElementById('skillName').value;
  const level = parseInt(document.getElementById('skillLevel').value);
  const type  = document.getElementById('skillType').value;
  const color = document.getElementById('skillColor').value;
  if(!name) return;

  cvData.skills.push({ name, level, type, color, id: Date.now() });
  updateSkillsList();
  updateSkillsPreview();

  document.getElementById('skillName').value = '';
  document.getElementById('skillLevel').value = '80';
}

function removeSkill(id){
  cvData.skills = cvData.skills.filter(s => s.id !== id);
  updateSkillsList();
  updateSkillsPreview();
}

function updateSkillsList(){
  const skillsList = document.getElementById('skillsList');
  skillsList.innerHTML = '';
  cvData.skills.forEach(skill => {
    const el = document.createElement('div');
    el.className = 'chip';
    el.innerHTML = `
      <span><i class="fas fa-grip-vertical drag-handle"></i> ${skill.name} (${skill.level}%)</span>
      <button class="btn dan" onclick="removeSkill(${skill.id})">ร</button>
    `;
    skillsList.appendChild(el);
  });

  new Sortable(skillsList, {
    animation:150, ghostClass:'sortable-ghost', chosenClass:'sortable-chosen', dragClass:'sortable-drag', handle:'.drag-handle',
    onEnd: (evt) => {
      const item = cvData.skills.splice(evt.oldIndex, 1)[0];
      cvData.skills.splice(evt.newIndex, 0, item);
      updateSkillsPreview();
    }
  });
}

// ======= ุงููุนุงููุฉ (ููุตุญูุญุฉ: ุฏุงุฆุฑุฉ ูุจูุฑุฉ + ูุฌูู SVG) =======
function updateSkillsPreview(){
  const skillsGrid = document.getElementById('skillsGrid');
  skillsGrid.innerHTML = '';

  cvData.skills.forEach(skill => {
    const level = clampPercent(skill.level);
    const skillColor = skill.color || '#3b82f6';
    let content = '';

    if (skill.type === 'circle'){
      // ุฏุงุฆุฑุฉ ูุจูุฑุฉ 64pxุ ุงููุณุจุฉ ุฏุงุฎููุง ููุท
      const size = 64, radius = 28, strokeW = 5;
      const cx = size/2, cy = size/2;
      const circumference = 2 * Math.PI * radius;
      const dash = (level/100) * circumference;

      content = `
        <div style="display:flex;align-items:center;gap:.5rem;min-width:0">
          <svg xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 ${size} ${size}" width="${size}" height="${size}"
               style="display:block;flex:0 0 auto;overflow:visible" role="img" aria-hidden="true">
            <circle cx="${cx}" cy="${cy}" r="${radius}"
                    stroke="#e5e7eb" stroke-width="${strokeW}" fill="none"
                    style="vector-effect:non-scaling-stroke"/>
            <circle cx="${cx}" cy="${cy}" r="${radius}"
                    stroke="${skillColor}" stroke-width="${strokeW}" fill="none"
                    stroke-linecap="round"
                    transform="rotate(-90 ${cx} ${cy})"
                    stroke-dasharray="${dash} ${circumference}"
                    style="vector-effect:non-scaling-stroke"/>
            <text x="${cx}" y="${cy}" text-anchor="middle" dominant-baseline="middle"
                  font-size="14" font-weight="700" fill="#111" style="line-height:1">${level}%</text>
          </svg>
          <div style="display:flex;flex-direction:column;min-width:0">
            <span class="label" style="font-weight:700;color:var(--heading);">${skill.name}</span>
          </div>
        </div>
      `;
    }
    else if (skill.type === 'stars'){
      // ูุฌูู SVG ุซุงุจุชุฉ
      const max = 5, filled = Math.round(level/20), starSize = 16;
      const starPath = 'M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z';
      const star = (fill) => `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
             width="${starSize}" height="${starSize}"
             style="display:inline-block;vertical-align:middle;margin-inline:1px">
          <path d="${starPath}" fill="${fill}"/>
        </svg>`;
      const starsHtml = Array.from({length:max}, (_,i)=> star(i<filled?skillColor:'#d1d5db')).join('');

      content = `
        <div style="display:flex;align-items:center;gap:.5rem;min-width:0">
          <div role="img" aria-label="${filled} ูู ${max}">
            ${starsHtml}
          </div>
          <div style="display:flex;flex-direction:column;min-width:0">
            <span class="label" style="font-weight:700;color:var(--heading);">${skill.name}</span>
            <span style="font-size:.85rem;color:#6b7280">${level}%</span>
          </div>
        </div>
      `;
    }
    else { // bar
      content = `
        <div class="bar-container" style="display:flex;flex-direction:column;gap:.5rem;width:100%">
          <div style="display:flex;align-items:center;justify-content:space-between;min-width:0">
            <span class="label" style="font-weight:700;color:var(--heading);">${skill.name}</span>
            <span style="font-size:.85rem;color:#6b7280">${level}%</span>
          </div>
          <div style="height:8px;background:#e5e7eb;border-radius:9999px;overflow:hidden;width:100%" aria-label="ุงููุณุชูู ${level}%">
            <div style="width:${level}%;height:100%;background:${skillColor}"></div>
          </div>
        </div>
      `;
    }

    const skillEl = document.createElement('div');
    skillEl.className = 'skill';
    skillEl.innerHTML = content;
    skillsGrid.appendChild(skillEl);
  });
}

function updateSkillColor(){
  const newColor = document.getElementById('skillColor').value;
  cvData.skills.forEach(s => { s.color = newColor; });
  updateSkillsPreview();
}

function getSkillColor(level){
  if (level >= 80) return '#22c55e';
  if (level >= 60) return '#3b82f6';
  if (level >= 40) return '#f59e0b';
  return '#ef4444';
}

// ======================= ุงูุฎุจุฑุงุช =======================
function addExperience(){
  const title = document.getElementById('expTitle').value;
  const company = document.getElementById('expCompany').value;
  const period = document.getElementById('expPeriod').value;
  const description = document.getElementById('expDescription').value;
  if(!title || !company) return;

  cvData.experiences.push({ title, company, period, description, id: Date.now() });
  updateExperiencesList();
  updateExperiencesPreview();

  document.getElementById('expTitle').value = '';
  document.getElementById('expCompany').value = '';
  document.getElementById('expPeriod').value = '';
  document.getElementById('expDescription').value = '';
}

function removeExperience(id){
  cvData.experiences = cvData.experiences.filter(e => e.id !== id);
  updateExperiencesList();
  updateExperiencesPreview();
}

function updateExperiencesList(){
  const list = document.getElementById('experiencesList');
  list.innerHTML = '';
  cvData.experiences.forEach(exp => {
    const el = document.createElement('div');
    el.className = 'chip';
    el.innerHTML = `
      <span><i class="fas fa-grip-vertical drag-handle"></i> ${exp.title} - ${exp.company}</span>
      <button class="btn dan" onclick="removeExperience(${exp.id})">ร</button>
    `;
    list.appendChild(el);
  });

  new Sortable(list, {
    animation:150, ghostClass:'sortable-ghost', chosenClass:'sortable-chosen', dragClass:'sortable-drag', handle:'.drag-handle',
    onEnd: (evt) => {
      const item = cvData.experiences.splice(evt.oldIndex, 1)[0];
      cvData.experiences.splice(evt.newIndex, 0, item);
      updateExperiencesPreview();
    }
  });
}

function updateExperiencesPreview(){
  const grid = document.getElementById('experiencesGrid');
  const layout = document.getElementById('experienceLayout').value;
  grid.innerHTML = '';
  grid.className = layout === 'horizontal' ? 'grid-layout' : '';

  cvData.experiences.forEach(exp => {
    const el = document.createElement('div');
    el.className = layout === 'horizontal' ? 'experience-item' : '';
    el.style.marginBottom = layout === 'vertical' ? '16px' : '0';
    el.innerHTML = `
      <div style="font-weight: bold; color: var(--heading);">${exp.title}</div>
      <div style="color: var(--secondary); font-weight: 600;">${exp.company}</div>
      <div style="font-size: 12px; color: #666; margin: 4px 0;">${exp.period}</div>
      <div style="font-size: 13px; line-height: 1.4;">${exp.description}</div>
    `;
    grid.appendChild(el);
  });
}

// ======================= ุงูุชุนููู =======================
function addEducation(){
  const degree = document.getElementById('eduDegree').value;
  const institution = document.getElementById('eduInstitution').value;
  const year = document.getElementById('eduYear').value;
  if(!degree || !institution) return;

  cvData.education.push({ degree, institution, year, id: Date.now() });
  updateEducationList();
  updateEducationPreview();

  document.getElementById('eduDegree').value = '';
  document.getElementById('eduInstitution').value = '';
  document.getElementById('eduYear').value = '';
}

function removeEducation(id){
  cvData.education = cvData.education.filter(e => e.id !== id);
  updateEducationList();
  updateEducationPreview();
}

function updateEducationList(){
  const list = document.getElementById('educationList');
  list.innerHTML = '';
  cvData.education.forEach(edu => {
    const el = document.createElement('div');
    el.className = 'chip';
    el.innerHTML = `
      <span><i class="fas fa-grip-vertical drag-handle"></i> ${edu.degree} - ${edu.institution}</span>
      <button class="btn dan" onclick="removeEducation(${edu.id})">ร</button>
    `;
    list.appendChild(el);
  });

  new Sortable(list, {
    animation:150, ghostClass:'sortable-ghost', chosenClass:'sortable-chosen', dragClass:'sortable-drag', handle:'.drag-handle',
    onEnd: (evt) => {
      const item = cvData.education.splice(evt.oldIndex, 1)[0];
      cvData.education.splice(evt.newIndex, 0, item);
      updateEducationPreview();
    }
  });
}

function updateEducationPreview(){
  const grid = document.getElementById('educationGrid');
  const layout = document.getElementById('educationLayout').value;
  grid.innerHTML = '';
  grid.className = layout === 'horizontal' ? 'grid-layout' : '';

  cvData.education.forEach(edu => {
    const el = document.createElement('div');
    el.className = layout === 'horizontal' ? 'education-item' : '';
    el.style.marginBottom = layout === 'vertical' ? '16px' : '0';
    el.innerHTML = `
      <div style="font-weight: bold; color: var(--heading);">${edu.degree}</div>
      <div style="color: var(--secondary); font-weight: 600;">${edu.institution}</div>
      <div style="font-size: 12px; color: #666; margin: 4px 0;">${edu.year}</div>
    `;
    grid.appendChild(el);
  });
}

// ======================= ุงููุบุงุช =======================
function addLanguage(){
  const name  = document.getElementById('langName').value;
  const level = document.getElementById('langLevel').value;
  if(!name) return;

  cvData.languages.push({ name, level, id: Date.now() });
  updateLanguagesList();
  updateLanguagesPreview();

  document.getElementById('langName').value = '';
  document.getElementById('langLevel').value = 'ูุจุชุฏุฆ';
}

function removeLanguage(id){
  cvData.languages = cvData.languages.filter(l => l.id !== id);
  updateLanguagesList();
  updateLanguagesPreview();
}

function updateLanguagesList(){
  const list = document.getElementById('languagesList');
  list.innerHTML = '';
  cvData.languages.forEach(lang => {
    const el = document.createElement('div');
    el.className = 'chip';
    el.innerHTML = `
      <span><i class="fas fa-grip-vertical drag-handle"></i> ${lang.name} - ${lang.level}</span>
      <button class="btn dan" onclick="removeLanguage(${lang.id})">ร</button>
    `;
    list.appendChild(el);
  });

  new Sortable(list, {
    animation:150, ghostClass:'sortable-ghost', chosenClass:'sortable-chosen', dragClass:'sortable-drag', handle:'.drag-handle',
    onEnd: (evt) => {
      const item = cvData.languages.splice(evt.oldIndex, 1)[0];
      cvData.languages.splice(evt.newIndex, 0, item);
      updateLanguagesPreview();
    }
  });
}

function updateLanguagesPreview(){
  const grid = document.getElementById('languagesGrid');
  grid.innerHTML = '';
  cvData.languages.forEach(lang => {
    const a = document.createElement('span'); a.textContent = lang.name;
    const b = document.createElement('span'); b.textContent = lang.level;
    grid.appendChild(a); grid.appendChild(b);
  });
}

// ======================= ุงูููุงูุงุช =======================
function addHobby(){
  const name = document.getElementById('hobbyName').value;
  const icon = document.getElementById('hobbyIcon').value;
  const description = document.getElementById('hobbyDescription').value;
  if(!name) return;

  cvData.hobbies.push({ name, icon, description, id: Date.now() });
  updateHobbiesList();
  updateHobbiesPreview();

  document.getElementById('hobbyName').value = '';
  document.getElementById('hobbyIcon').value = '';
  document.getElementById('hobbyDescription').value = '';
}

function removeHobby(id){
  cvData.hobbies = cvData.hobbies.filter(h => h.id !== id);
  updateHobbiesList();
  updateHobbiesPreview();
}

function updateHobbiesList(){
  const list = document.getElementById('hobbiesList');
  list.innerHTML = '';
  cvData.hobbies.forEach(hobby => {
    const el = document.createElement('div');
    el.className = 'chip';
    el.innerHTML = `
      <span><i class="fas fa-grip-vertical drag-handle"></i> ${hobby.icon} ${hobby.name}</span>
      <button class="btn dan" onclick="removeHobby(${hobby.id})">ร</button>
    `;
    list.appendChild(el);
  });

  new Sortable(list, {
    animation:150, ghostClass:'sortable-ghost', chosenClass:'sortable-chosen', dragClass:'sortable-drag', handle:'.drag-handle',
    onEnd: (evt) => {
      const item = cvData.hobbies.splice(evt.oldIndex, 1)[0];
      cvData.hobbies.splice(evt.newIndex, 0, item);
      updateHobbiesPreview();
    }
  });
}

function updateHobbiesPreview(){
  const grid = document.getElementById('hobbiesGrid');
  const displayType = document.getElementById('hobbiesDisplay').value;
  grid.innerHTML = '';

  if (displayType === 'tags'){
    cvData.hobbies.forEach(hobby => {
      const el = document.createElement('div');
      el.className = 'tag';
      el.innerHTML = `<span>${hobby.icon}</span><span>${hobby.name}</span>`;
      grid.appendChild(el);
    });
  } else if (displayType === 'list'){
    const list = document.createElement('div');
    list.className = 'kv';
    cvData.hobbies.forEach(hobby => {
      const i = document.createElement('span'); i.textContent = hobby.icon;
      const n = document.createElement('span'); n.textContent = hobby.name;
      list.appendChild(i); list.appendChild(n);
    });
    grid.appendChild(list);
  } else {
    grid.style.display = 'grid';
    grid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(120px, 1fr))';
    grid.style.gap = '8px';
    cvData.hobbies.forEach(hobby => {
      const el = document.createElement('div');
      el.style.cssText = `
        background:#f8fafc;border:var(--card-border);border-radius:var(--card-radius);
        padding:var(--card-pad);text-align:center;font-size:12px;
      `;
      el.innerHTML = `
        <div style="font-size:16px;margin-bottom:4px;">${hobby.icon}</div>
        <div style="font-weight:bold;color:var(--heading);">${hobby.name}</div>
        ${hobby.description ? `<div style="font-size:10px;color:#666;margin-top:2px;">${hobby.description}</div>` : ''}
      `;
      grid.appendChild(el);
    });
  }
}

// ======================= ุจูุงูุงุช ุฅุถุงููุฉ =======================
function addExtraData(){
  const sectionName = document.getElementById('extraSectionName').value;
  const title   = document.getElementById('extraTitle').value;
  const details = document.getElementById('extraDetails').value;
  const date    = document.getElementById('extraDate').value;
  const icon    = document.getElementById('extraIcon').value;
  if(!sectionName || !title) return;

  if(!cvData.extraSections[sectionName]) cvData.extraSections[sectionName] = [];
  cvData.extraSections[sectionName].push({ title, details, date, icon, id: Date.now() });

  updateExtraDataList();
  updateExtraDataPreview();

  document.getElementById('extraTitle').value = '';
  document.getElementById('extraDetails').value = '';
  document.getElementById('extraDate').value = '';
  document.getElementById('extraIcon').value = '';
}

function removeExtraData(sectionName, id){
  cvData.extraSections[sectionName] = cvData.extraSections[sectionName].filter(i => i.id !== id);
  if (cvData.extraSections[sectionName].length === 0) delete cvData.extraSections[sectionName];
  updateExtraDataList();
  updateExtraDataPreview();
}

function updateExtraDataList(){
  const list = document.getElementById('extraDataList');
  list.innerHTML = '';
  Object.keys(cvData.extraSections).forEach(sectionName => {
    cvData.extraSections[sectionName].forEach(item => {
      const el = document.createElement('div');
      el.className = 'chip';
      el.innerHTML = `
        <span><i class="fas fa-grip-vertical drag-handle"></i> ${sectionName}: ${item.title}</span>
        <button class="btn dan" onclick="removeExtraData('${sectionName}', ${item.id})">ร</button>
      `;
      list.appendChild(el);
    });
  });
}

function updateExtraDataPreview(){
  const holder = document.getElementById('extraSections');
  holder.innerHTML = '';
  const displayType = document.getElementById('extraDataDisplay').value;

  Object.keys(cvData.extraSections).forEach(sectionName => {
    const sectionEl = document.createElement('div');
    sectionEl.className = 'section';
    sectionEl.innerHTML = `<h3>${sectionName}</h3>`;
    const items = document.createElement('div');
    if (displayType === 'grid') items.className = 'grid-layout';

    cvData.extraSections[sectionName].forEach(item => {
      const el = document.createElement('div');
      if (displayType === 'grid'){
        el.className = 'extra-data-item';
        el.innerHTML = `
          <div style="font-weight:bold;color:var(--heading);margin-bottom:8px;">
            ${item.icon ? item.icon + ' ' : ''}${item.title}
          </div>
          ${item.details ? `<div style="color:var(--secondary-text-color);font-size:13px;margin-bottom:6px;">${item.details}</div>` : ''}
          ${item.date ? `<div style="font-size:11px;color:#888;font-weight:600;">${item.date}</div>` : ''}
        `;
      } else {
        el.style.marginBottom = '16px';
        el.innerHTML = `
          <div style="font-weight:bold;color:var(--heading);">
            ${item.icon ? item.icon + ' ' : ''}${item.title}
          </div>
          ${item.details ? `<div style="color:var(--secondary);font-weight:600;">${item.details}</div>` : ''}
          ${item.date ? `<div style="font-size:12px;color:#666;margin:4px 0;">${item.date}</div>` : ''}
        `;
      }
      items.appendChild(el);
    });

    sectionEl.appendChild(items);
    holder.appendChild(sectionEl);
  });
}

// ======================= ุชุญูู ุงูุฃููุงู ูุงูุฎุทูุท =======================
function applyColorPalette(primary, secondary){
  document.getElementById('primaryColor').value = primary;
  document.getElementById('secondaryColor').value = secondary;
  updateColors();
}

function updateColors(){
  const primary = document.getElementById('primaryColor').value;
  const secondary = document.getElementById('secondaryColor').value;
  document.documentElement.style.setProperty('--primary', primary);
  document.documentElement.style.setProperty('--secondary', secondary);
}

function updateFontColors(){
  const nameColor = document.getElementById('nameColor').value;
  const headingColor = document.getElementById('headingColor').value;
  const textColor = document.getElementById('textColor').value;
  const secondaryTextColor = document.getElementById('secondaryTextColor').value;
  document.documentElement.style.setProperty('--name-color', nameColor);
  document.documentElement.style.setProperty('--heading-color', headingColor);
  document.documentElement.style.setProperty('--text-color', textColor);
  document.documentElement.style.setProperty('--secondary-text-color', secondaryTextColor);
}

function updateFontFamily(){
  const fontFamily = document.getElementById('fontFamily').value;
  document.documentElement.style.setProperty('--font-body', `"${fontFamily}", sans-serif`);
  document.documentElement.style.setProperty('--font-head', `"${fontFamily}", sans-serif`);
  document.documentElement.style.setProperty('--font-name', `"${fontFamily}", sans-serif`);
}

function updateFontSizes(){
  const nameFont = document.getElementById('nameFont').value;
  const headingFont = document.getElementById('headingFont').value;
  const baseFont = document.getElementById('baseFont').value;
  document.getElementById('nameFontValue').textContent = nameFont + 'px';
  document.getElementById('headingFontValue').textContent = headingFont + 'px';
  document.getElementById('baseFontValue').textContent = baseFont + 'px';
  document.documentElement.style.setProperty('--name-font', nameFont + 'px');
  document.documentElement.style.setProperty('--h3-font', headingFont + 'px');
  document.documentElement.style.setProperty('--base-font', baseFont + 'px');
}

function updateSpacing(){
  const sectionGap = document.getElementById('sectionGap').value;
  const itemGap    = document.getElementById('itemGap').value;
  const cardPad    = document.getElementById('cardPadding').value;
  document.getElementById('sectionGapValue').textContent = sectionGap + 'px';
  document.getElementById('itemGapValue').textContent    = itemGap + 'px';
  document.getElementById('cardPaddingValue').textContent= cardPad + 'px';
  document.documentElement.style.setProperty('--section-gap', sectionGap + 'px');
  document.documentElement.style.setProperty('--item-gap', itemGap + 'px');
  document.documentElement.style.setProperty('--card-pad', cardPad + 'px');
}

function updateBorders(){
  const bw = document.getElementById('borderWidth').value;
  const bc = document.getElementById('borderColor').value;
  const br = document.getElementById('borderRadius').value;
  document.getElementById('borderWidthValue').textContent = bw + 'px';
  document.getElementById('borderRadiusValue').textContent = br + 'px';
  document.documentElement.style.setProperty('--card-border', `${bw}px solid ${bc}`);
  document.documentElement.style.setProperty('--card-radius', br + 'px');
}

// ======================= PDF & ุงูุฏูุน =======================
function showPaymentModal(){ document.getElementById('paymentModal').classList.remove('hidden'); }
function hidePaymentModal(){ document.getElementById('paymentModal').classList.add('hidden'); }
function downloadPDF(){ hidePaymentModal(); generatePDF(); }
function payAndDownload(){ hidePaymentModal(); generatePDF(); window.open('https://hex-store.com/QzvEwqD', '_blank'); }

function generatePDF(){
document.body.classList.add('exporting');

  try{
    if (typeof jspdf === 'undefined' || typeof jspdf.jsPDF === 'undefined'){
      console.error('ููุชุจุฉ jsPDF ุบูุฑ ูุญููุฉ. ุฌุงุฑู ุฅุนุงุฏุฉ ุชุญููููุง...');
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js';
      script.onload = () => setTimeout(generatePDF, 500);
      script.onerror = () => alert('ูุดู ุชุญููู jsPDF. ุญุฏูุซ ุงูุตูุญุฉ ูุฌุฑุจ.');
      document.head.appendChild(script);
      return;
    }

    const element = document.getElementById('cvPreview');
    const printElement = element.cloneNode(true);
    Object.assign(printElement.style, {
      transform:'none', boxShadow:'none', borderRadius:'0',
      width:'210mm', height:'297mm', overflow:'hidden',
      position:'absolute', left:'-9999px', top:'-9999px'
    });
    document.body.appendChild(printElement);

    html2canvas(printElement, {
      scale:2, useCORS:true, allowTaint:true,
      width:794, height:1123, backgroundColor:'#ffffff', logging:false,
      onclone: (doc) => {
        const aside = doc.getElementById('cvPreview')?.querySelector('.aside');
        if (aside){ aside.style.minHeight = '297mm'; aside.style.height = '100%'; }
      }
    }).then(canvas => {
      document.body.removeChild(printElement);
      const imgData = canvas.toDataURL('image/jpeg', 0.95);
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p','mm','a4');
      pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297);
      pdf.save('ุณูุฑุชู_ุงูุฐุงุชูุฉ.pdf');
    }).catch(err => {
      if (document.body.contains(printElement)) document.body.removeChild(printElement);
      console.error('HTML2Canvas error:', err);
      alert('ุญุฏุซ ุฎุทุฃ ูู ุชุตููุฑ ุงููุณุชูุฏ. ุญุงูู ูุฑุฉ ุฃุฎุฑู.');
    });
  } catch(e){
    console.error('PDF general error:', e);
    alert('ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน. ุญุฏูุซ ุงูุตูุญุฉ ูุญุงูู ูุฑุฉ ุฃุฎุฑู.');
    document.body.classList.remove('exporting');

  }
}

document.getElementById('paymentModal').addEventListener('click', function(e){
  if (e.target === this) hidePaymentModal();
});

// ======================= ุชุฑุชูุจ ุงูุฃูุณุงู =======================
let sectionOrder = ['contact','skills','languages','hobbies','summary','experiences','education','extra'];
let sectionLocation = {
  contact:'sidebar', skills:'sidebar', languages:'sidebar', hobbies:'sidebar',
  summary:'main', experiences:'main', education:'main', extra:'main'
};
let sectionVisibility = {
  contact:true, skills:true, languages:true, hobbies:true,
  summary:true, experiences:true, education:true, extra:true, header:true
};

// ุฏุงูุฉ ููุญูุฏุฉ ุชุฏุนู ุงูููุทูู: toggleSection('x', true/false) ุฃู toggleSection('x')
function toggleSection(sectionName, maybeVisible){
  // ููุท ุนูุงุตุฑ ุงูุชุญูู (ูููุฉ Boolean)
  if (typeof maybeVisible === 'boolean'){
    sectionVisibility[sectionName] = maybeVisible;
    updateSectionsDisplay();
    return;
  }
  // ููุท ูุฏูู: ุชุจุฏูู ูุจุงุดุฑ ูุนูุตุฑ ุงููุณู + ูุฒุงููุฉ ุงูุฑุคูุฉ
  const sectionElement = document.getElementById(sectionName + 'Section');
  if (sectionElement){
    const nowHidden = sectionElement.style.display !== 'none' ? true : false;
    sectionElement.style.display = nowHidden ? 'none' : 'flex';
    sectionVisibility[sectionName] = !nowHidden;
    updateSectionsDisplay();
  }
}

function toggleHeaderSection(){
  const hideHeader = document.getElementById('hideHeader').checked;
  sectionVisibility.header = !hideHeader;
  updateSectionsDisplay();
}

function updateSidebarWidth(){
  const width = document.getElementById('sidebarWidth').value;
  document.documentElement.style.setProperty('--aside-w', width);
}

function updateSectionsDisplay(){
  // ุงูุฑุฃุณ
  const headerSection = document.getElementById('headerSection');
  if (headerSection){
    headerSection.style.display = sectionVisibility.header ? 'flex' : 'none';
    headerSection.style.order = sectionVisibility.header ? '0' : '999';
  }

  let sidebarOrder = 1, mainOrder = 0;
  sectionOrder.forEach(name => {
    const el = getSectionElement(name);
    if (!el) return;

    el.style.display = sectionVisibility[name] ? 'flex' : 'none';
    if (sectionVisibility[name]){
      if (sectionLocation[name] === 'sidebar'){
        el.style.order = String(sidebarOrder++); 
      } else {
        el.style.order = String(mainOrder++);
      }
    } else {
      el.style.order = '999';
    }

    const target = sectionLocation[name] === 'sidebar' ? document.querySelector('.aside') : document.querySelector('.main');
    if (el.parentNode !== target) target.appendChild(el);
  });
}

function getSectionElement(name){
  if (name === 'summary') return document.getElementById('summarySection');
  if (name === 'experiences') return document.getElementById('experiencesSection');
  if (name === 'education') return document.getElementById('educationSection');
  if (name === 'extra') return document.getElementById('extraSections');
  return document.getElementById(name + 'Section');
}

function changeSectionLocation(name, loc){
  sectionLocation[name] = loc;
  updateSectionsDisplay();
}

function resetSectionsOrder(){
  sectionOrder = ['contact','skills','languages','hobbies','summary','experiences','education','extra'];
  sectionLocation = {
    contact:'sidebar', skills:'sidebar', languages:'sidebar', hobbies:'sidebar',
    summary:'main', experiences:'main', education:'main', extra:'main'
  };
  sectionVisibility = {
    contact:true, skills:true, languages:true, hobbies:true,
    summary:true, experiences:true, education:true, extra:true, header:true
  };

  document.querySelectorAll('#allSectionsList input[type="checkbox"]').forEach(cb => cb.checked = true);
  document.querySelectorAll('#allSectionsList select').forEach(sel => {
    const sectionName = sel.closest('.chip').getAttribute('data-section');
    sel.value = sectionLocation[sectionName];
  });
  document.getElementById('hideHeader').checked = false;
  document.getElementById('sidebarWidth').value = '280px';

  updateSidebarWidth();
  updateSectionsDisplay();
}

// ======================= ุชููุฆุฉ ูุณููู ุงููุนุงููุฉ =======================
document.addEventListener('DOMContentLoaded', function(){
  updatePreview();
  updateFontSizes();
  updateSpacing();
  updateBorders();

  new Sortable(document.getElementById('allSectionsList'), {
    animation:150, ghostClass:'sortable-ghost', chosenClass:'sortable-chosen', dragClass:'sortable-drag', handle:'.drag-handle',
    onEnd: function(){
      const newOrder = [];
      document.querySelectorAll('#allSectionsList .chip').forEach(chip => {
        newOrder.push(chip.getAttribute('data-section'));
      });
      sectionOrder = newOrder;
      updateSectionsDisplay();
    }
  });
});

(function(){
  const SCALE_MIN = 10, SCALE_MAX = 120;
  let manualOverride = false;

  function px(v){ return isNaN(v) ? 0 : v; }
  function getPaddingX(el){
    if(!el) return 0;
    const cs = getComputedStyle(el);
    return px(parseFloat(cs.paddingLeft)) + px(parseFloat(cs.paddingRight));
  }
  function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

  window.updateScale = function(){
    const slider = document.getElementById('scaleSlider');
    const page   = document.querySelector('.a4');
    const out    = document.getElementById('scaleValue');
    if(!slider || !page) return;
    const scale = Number(slider.value)/100;
    page.style.transform = `scale(${scale})`;
    page.style.transformOrigin = 'top center';
    if(out) out.textContent = Math.round(scale*100) + '%';
  };

  function fitToWidthOnce(){
    const preview   = document.querySelector('.preview');
    const container = document.querySelector('.a4-container');
    const page      = document.querySelector('.a4');
    const slider    = document.getElementById('scaleSlider');
    if(!preview || !page || !slider) return;
    const available = preview.clientWidth - getPaddingX(preview) - getPaddingX(container);
    const pageWidth = page.offsetWidth;
    const scale = clamp(available / pageWidth, SCALE_MIN/100, SCALE_MAX/100);
    slider.value = Math.round(scale*100);
    updateScale();
  }

  function autoFitSmallScreens(){
    if (window.matchMedia('(max-width: 768px)').matches && !manualOverride){
      fitToWidthOnce();
    } else {
      const slider = document.getElementById('scaleSlider');
      if (slider && !manualOverride){
        slider.value = 100;
        updateScale();
      }
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    const slider = document.getElementById('scaleSlider');
    if (slider) slider.addEventListener('input', () => { manualOverride = true; });
    autoFitSmallScreens();
  });

  let t;
  window.addEventListener('resize', () => {
    clearTimeout(t);
    t = setTimeout(() => { autoFitSmallScreens(); }, 150);
  });
})();
</script>
</body>
</html>